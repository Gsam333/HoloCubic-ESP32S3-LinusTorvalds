[env:esp32-s3-devkitc-1]
platform = espressif32@~6.4.0
board = esp32-s3-devkitc-1
framework = arduino

; ========================================
; Linus Torvalds 项目配置 - 最小化版本
; 简洁、高效、可靠的嵌入式系统
; ========================================

; Linus风格统一配置 - 清洁的编译器标志
build_flags = 
    -I src                          ; 统一src包含路径
    -I config                       ; 统一config包含路径
    -I src/core/boot                ; 启动相关头文件
    -I src/core/config              ; 配置相关头文件
    -I src/core/state               ; 状态相关头文件
    -I src/core/types               ; 类型定义头文件
    -I src/app/core                 ; 应用核心头文件
    -I src/app/managers             ; 应用管理器头文件
    -I src/system                   ; 系统相关头文件
    -I src/drivers/display          ; 显示驱动头文件
    -I src/drivers/led              ; LED驱动头文件
    ; -I src/drivers/storage/flash    ; Flash存储头文件
    ; -I src/drivers/storage/sd       ; SD卡存储头文件
    -I lib/TFT_eSPI
    -I lib/FastLED
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    -DCONFIG_DISABLE_HAL_LOCKS=1
    -DUSE_DMA=1
    -Os
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections
    -mlongcalls                 ; 修复ESP32-S3链接器call8错误 -mlongcalls 
    -Wall
    -Wextra
    -Wno-unused-parameter
    -Wno-missing-field-initializers

; 修复ESP32工具链的已知编译器参数问题 - Linus风格：一次性解决
build_unflags = 
    -fstrict-volatile-bitfields     ; 移除不兼容的参数
    -fno-tree-switch-conversion     ; 移除不兼容的参数

; 串口配置
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Flash 配置 - 使用8MB分区表
board_build.partitions = FLASH_8MB.csv
board_build.filesystem = spiffs

; 内存配置 - 充分利用ESP32-S3的能力
board_build.flash_mode = qio
board_build.f_flash = 80000000L
board_build.f_cpu = 240000000L
board_build.psram_type = opi
board_build.boot = qio
board_build.arduino.memory_type = qio_opi

; 第三方库依赖 - 只包含必需的
lib_deps = 
    ; fastled/FastLED@^3.6.0

; 库目录配置 - 使用本地库
lib_extra_dirs = lib

; 源文件过滤 - 排除测试目录和原IMU驱动 - 轻易不要修改
build_src_filter = +<*> -<test/*/src/main.cpp> -<src/drivers/imu/*> -<src/test/imu_test.*>

; 上传配置
upload_speed = 921600

; 调试配置
debug_tool = esp-builtin
debug_init_break = tbreak setup

; ========================================
; 生产环境构建配置 (暂时不需要)
; ========================================

; [env:esp32-s3-production]
; extends = env:esp32-s3-devkitc-1
; 
; ; 生产环境编译标志
; build_flags = 
;     ${env:esp32-s3-devkitc-1.build_flags}
;     -DPRODUCTION_BUILD=1
;     -DCORE_DEBUG_LEVEL=0
;     -Os
;     -DNDEBUG
; 
; ; 生产环境不需要调试符号
; build_type = release